<?xml version="1.0"?>
<!-- 
  AgileX Piper Robot Arm URDF - CORRECTED VERSION
  Based on official DH parameters from piper_sdk/kinematics/piper_fk.py
  
  DH Parameters (modified convention):
  Link  a(mm)    d(mm)    alpha(rad)         theta_offset(deg)
  1     0        123      0                  0
  2     0        0        -π/2               -172.22
  3     285.03   0        0                  -102.78
  4     -21.98   250.75   π/2                0
  5     0        0        -π/2               0
  6     0        91       π/2                0
-->
<robot name="piper">
  
  <!-- ============================================ -->
  <!-- BASE LINK -->
  <!-- ============================================ -->
  <link name="base_link">
    <inertial>
      <origin xyz="0 0 0.0615" rpy="0 0 0"/>
      <mass value="1.58"/>
      <inertia ixx="0.0079" ixy="0" ixz="0" iyy="0.0079" iyz="0" izz="0.0079"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.0615" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.08" length="0.123"/>
      </geometry>
      <material name="dark_gray">
        <color rgba="0.2 0.2 0.2 1.0"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.0615" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.08" length="0.123"/>
      </geometry>
    </collision>
  </link>

  <!-- ============================================ -->
  <!-- LINK 1 (after Joint 1 - base rotation) -->
  <!-- ============================================ -->
  <link name="link1">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="0.79"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.0004"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.04" length="0.05"/>
      </geometry>
      <material name="orange">
        <color rgba="0.9 0.5 0.2 1.0"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.04" length="0.05"/>
      </geometry>
    </collision>
  </link>

  <!-- Joint 1: Base rotation (Z-axis) -->
  <!-- d1 = 123mm = 0.123m -->
  <!-- Physical limit: ±154° = ±2.68781 rad -->
  <!-- Max speed: 180°/s = 3.14159 rad/s -->
  <joint name="joint1" type="revolute">
    <parent link="base_link"/>
    <child link="link1"/>
    <origin xyz="0 0 0.123" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-2.68781" upper="2.68781" effort="2000" velocity="3.14159"/>
    <dynamics damping="2.0" friction="0.2"/>
  </joint>

  <!-- ============================================ -->
  <!-- LINK 2 (shoulder - long horizontal link) -->
  <!-- ============================================ -->
  <link name="link2">
    <inertial>
      <origin xyz="0.14251 0 0" rpy="0 0 0"/>
      <mass value="0.63"/>
      <inertia ixx="0.0043" ixy="0" ixz="0" iyy="0.0043" iyz="0" izz="0.0002"/>
    </inertial>
    <visual>
      <origin xyz="0.14251 0 0" rpy="0 1.5708 0"/>
      <geometry>
        <cylinder radius="0.03" length="0.28503"/>
      </geometry>
      <material name="light_gray">
        <color rgba="0.7 0.7 0.7 1.0"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0.14251 0 0" rpy="0 1.5708 0"/>
      <geometry>
        <cylinder radius="0.03" length="0.28503"/>
      </geometry>
    </collision>
  </link>

  <!-- Joint 2: Shoulder pitch (Y-axis) -->
  <!-- alpha1 = -π/2, so coordinate frame rotates -->
  <!-- Physical limit: 0→195° = 0→3.40339 rad -->
  <!-- Max speed: 195°/s = 3.40339 rad/s -->
  <!-- EXTREME EFFORT: Must lift entire arm weight vertically against gravity! -->
  <joint name="joint2" type="revolute">
    <parent link="link1"/>
    <child link="link2"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="0" upper="3.40339" effort="8000" velocity="3.40339"/>
    <dynamics damping="3.0" friction="0.3"/>
  </joint>

  <!-- ============================================ -->
  <!-- LINK 3 (forearm - second horizontal link) -->
  <!-- ============================================ -->
  <link name="link3">
    <inertial>
      <origin xyz="0.125375 0 0" rpy="0 0 0"/>
      <mass value="0.48"/>
      <inertia ixx="0.0025" ixy="0" ixz="0" iyy="0.0025" iyz="0" izz="0.0001"/>
    </inertial>
    <visual>
      <origin xyz="0.125375 0 0" rpy="0 1.5708 0"/>
      <geometry>
        <cylinder radius="0.025" length="0.25075"/>
      </geometry>
      <material name="light_gray"/>
    </visual>
    <collision>
      <origin xyz="0.125375 0 0" rpy="0 1.5708 0"/>
      <geometry>
        <cylinder radius="0.025" length="0.25075"/>
      </geometry>
    </collision>
  </link>

  <!-- Joint 3: Elbow pitch (Y-axis) -->
  <!-- a2 = 285.03mm = 0.28503m -->
  <!-- Physical limit: -175→0° = -3.05433→0 rad -->
  <!-- Max speed: 180°/s = 3.14159 rad/s -->
  <!-- VERY HIGH EFFORT: Must extend forearm and wrist weight -->
  <joint name="joint3" type="revolute">
    <parent link="link2"/>
    <child link="link3"/>
    <origin xyz="0.28503 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-3.05433" upper="0" effort="6000" velocity="3.14159"/>
    <dynamics damping="2.5" friction="0.25"/>
  </joint>

  <!-- ============================================ -->
  <!-- LINK 4 (wrist section 1) -->
  <!-- ============================================ -->
  <link name="link4">
    <inertial>
      <origin xyz="0 0 0.045" rpy="0 0 0"/>
      <mass value="0.32"/>
      <inertia ixx="0.0004" ixy="0" ixz="0" iyy="0.0004" iyz="0" izz="0.0001"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.04" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.022" length="0.08"/>
      </geometry>
      <material name="dark_gray"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.04" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.022" length="0.08"/>
      </geometry>
    </collision>
  </link>

  <!-- Joint 4: Wrist roll (X-axis) -->
  <!-- d3 = 250.75mm = 0.25075m (but this is offset in Z due to alpha) -->
  <!-- Physical limit: ±106° = ±1.85005 rad -->
  <!-- Max speed: 225°/s = 3.92699 rad/s -->
  <joint name="joint4" type="revolute">
    <parent link="link3"/>
    <child link="link4"/>
    <origin xyz="0.25075 0 0" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <limit lower="-1.85005" upper="1.85005" effort="50" velocity="3.92699"/>
    <dynamics damping="0.3" friction="0.05"/>
  </joint>

  <!-- ============================================ -->
  <!-- LINK 5 (wrist section 2) -->
  <!-- ============================================ -->
  <link name="link5">
    <inertial>
      <origin xyz="0 0 0.025" rpy="0 0 0"/>
      <mass value="0.24"/>
      <inertia ixx="0.0002" ixy="0" ixz="0" iyy="0.0002" iyz="0" izz="0.0001"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.025" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.02" length="0.05"/>
      </geometry>
      <material name="light_gray"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.025" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.02" length="0.05"/>
      </geometry>
    </collision>
  </link>

  <!-- Joint 5: Wrist pitch (Y-axis) -->
  <!-- alpha4 = -π/2 rotation -->
  <!-- Physical limit: ±75° = ±1.30900 rad -->
  <!-- Max speed: 225°/s = 3.92699 rad/s -->
  <joint name="joint5" type="revolute">
    <parent link="link4"/>
    <child link="link5"/>
    <origin xyz="0 0 0.08" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.30900" upper="1.30900" effort="50" velocity="3.92699"/>
    <dynamics damping="0.3" friction="0.05"/>
  </joint>

  <!-- ============================================ -->
  <!-- LINK 6 (end effector mounting) -->
  <!-- ============================================ -->
  <link name="link6">
    <inertial>
      <origin xyz="0 0 0.0455" rpy="0 0 0"/>
      <mass value="0.16"/>
      <inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.00005"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.0455" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.018" length="0.091"/>
      </geometry>
      <material name="dark_gray"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.0455" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.018" length="0.091"/>
      </geometry>
    </collision>
  </link>

  <!-- Joint 6: Wrist rotation (Z-axis) -->
  <!-- d5 = 91mm = 0.091m -->
  <!-- Physical limit: ±100° = ±1.74533 rad -->
  <!-- Max speed: 225°/s = 3.92699 rad/s -->
  <joint name="joint6" type="revolute">
    <parent link="link5"/>
    <child link="link6"/>
    <origin xyz="0 0 0.05" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.74533" upper="1.74533" effort="30" velocity="3.92699"/>
    <dynamics damping="0.2" friction="0.05"/>
  </joint>

  <!-- ============================================ -->
  <!-- END EFFECTOR LINK -->
  <!-- ============================================ -->
  <link name="end_effector">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="0.01"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="0.015"/>
      </geometry>
      <material name="red">
        <color rgba="1.0 0.2 0.2 1.0"/>
      </material>
    </visual>
  </link>

  <!-- End Effector Joint -->
  <joint name="ee_joint" type="fixed">
    <parent link="link6"/>
    <child link="end_effector"/>
    <origin xyz="0 0 0.091" rpy="0 0 0"/>
  </joint>

  <!-- ============================================ -->
  <!-- GRIPPER (simplified placeholder) -->
  <!-- ============================================ -->
  <link name="gripper_base">
    <visual>
      <origin xyz="0 0 0.02" rpy="0 0 0"/>
      <geometry>
        <box size="0.04 0.04 0.04"/>
      </geometry>
      <material name="dark_gray"/>
    </visual>
  </link>

  <joint name="gripper_joint" type="fixed">
    <parent link="end_effector"/>
    <child link="gripper_base"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- Left Finger -->
  <link name="left_finger">
    <visual>
      <origin xyz="0 0.015 0.025" rpy="0 0 0"/>
      <geometry>
        <box size="0.01 0.01 0.05"/>
      </geometry>
      <material name="light_gray"/>
    </visual>
    <collision>
      <origin xyz="0 0.015 0.025" rpy="0 0 0"/>
      <geometry>
        <box size="0.01 0.01 0.05"/>
      </geometry>
    </collision>
  </link>

  <joint name="left_finger_joint" type="prismatic">
    <parent link="gripper_base"/>
    <child link="left_finger"/>
    <origin xyz="0 0.01 0.02" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="0" upper="0.04" effort="10" velocity="0.1"/>
  </joint>

  <!-- Right Finger -->
  <link name="right_finger">
    <visual>
      <origin xyz="0 -0.015 0.025" rpy="0 0 0"/>
      <geometry>
        <box size="0.01 0.01 0.05"/>
      </geometry>
      <material name="light_gray"/>
    </visual>
    <collision>
      <origin xyz="0 -0.015 0.025" rpy="0 0 0"/>
      <geometry>
        <box size="0.01 0.01 0.05"/>
      </geometry>
    </collision>
  </link>

  <joint name="right_finger_joint" type="prismatic">
    <parent link="gripper_base"/>
    <child link="right_finger"/>
    <origin xyz="0 -0.01 0.02" rpy="0 0 0"/>
    <axis xyz="0 -1 0"/>
    <limit lower="0" upper="0.04" effort="10" velocity="0.1"/>
  </joint>

  <!-- ============================================ -->
  <!-- TRANSMISSION ELEMENTS (for ROS Control) -->
  <!-- ============================================ -->
  
  <transmission name="joint1_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint1">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="joint1_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="joint2_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint2">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="joint2_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="joint3_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint3">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="joint3_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="joint4_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint4">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="joint4_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="joint5_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint5">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="joint5_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="joint6_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint6">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="joint6_motor">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

</robot>
